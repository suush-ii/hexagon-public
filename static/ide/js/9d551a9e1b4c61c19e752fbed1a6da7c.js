;// bundle: Pages___Messages___5501a6707ec9ffb5580df34b5bbbd1de_m
;// files: modules/Pages/Messages.js

;// modules/Pages/Messages.js
Roblox.define("Pages.Messages",["Widgets.AvatarImage","jQuery","Resources.Messages"],function(n,t){function tt(){return+new Date}function u(){}function a(n){for(var t=0;t<o.length;t++)if(o[t].TabValue==n)return o[t].HashPart;return o[0].HashPart}function kt(n){var i,t;if(!isNaN(parseInt(n)))return n;if(n!==undefined&&n.indexOf(it)!=-1)return i=parseInt(n.substring(n.length-1,n.length)),i-1;for(t=0;t<o.length;t++)if(o[t].HashPart==n)return o[t].TabValue;return o[0].TabValue}function ct(n){rt=!1;var t=History.getState().data,e=i==r.Inbox?n:t.messagePage,o=i==r.Archive?n:t.archivePage,u=i==r.Sent?n:t.sentPage,f=i==r.Announcements?n:t.notificationsPage;History.pushState({archivePage:o,messagePage:e,sentPage:u,notificationsPage:f,tab:i},bt,"?"+i)}function wt(){i==undefined&&(i=r.Inbox);var n=History.getState().data;if(n.tab!=undefined&&n.messagePage!=undefined&&n.archivePage!=undefined&&n.sentPage!=undefined&&n.notificationsPage!=undefined){d(n);return}c=!0,History.replaceState({archivePage:1,messagePage:1,sentPage:1,notificationsPage:1,tab:i},"ROBLOX - "+Resources.Messages.messages,"?"+a(i)),i==r.Inbox?h(Roblox.MessagesPager,Roblox.MessagesPager.startIndex,-1):i==r.Archive?h(Roblox.ArchivedPager,Roblox.ArchivedPager.startIndex,-1):i==r.Sent?h(Roblox.SentPager,Roblox.SentPager.startIndex,-1):i==r.Notifications||i==r.Announcements?h(Roblox.NotificationsPager,Roblox.NotificationsPager.startIndex,-1):Roblox.Widgets.AvatarImage.populate()}function vt(n,r,f,e,o,h){i=kt(h),t("#MessagesTabs").tabs("option","active",i),p=!0,s=n,y=t("#ie7").length!=0;var c={Paging_PageNumbers_AreLinks:!1,FetchItemsOnLoad:!1,pagingClickFunction:ct};Roblox.MessagesPager=new DataPager(r,s,"MessagesInbox","pagingInbox",u,u,u,c),Roblox.ArchivedPager=new DataPager(f,s,"MessagesArchived","pagingArchived",u,u,u,c),Roblox.SentPager=new DataPager(e,s,"MessagesSent","pagingSent",u,u,u,c),Roblox.NotificationsPager=new DataPager(o,s,"MessagesSystem","pagingSystem",u,u,u,c),window.onpageshow=function(n){n.persisted&&window.location.reload()},wt()}function yt(n){n?(t("#sent-general-buttons").hide(),t("#sent-detail-buttons").show(),t("#MessagesDetailSent").show(),t("#MessagesSent").hide()):(t("#sent-general-buttons").show(),t("#sent-detail-buttons").hide(),t("#MessagesDetailSent").hide(),t("#MessagesSent").show())}function lt(n){n?(t("#system-general-buttons").hide(),t("#system-detail-buttons").show(),t("#MessagesDetailSystem").show(),t("#MessagesSystem").hide()):(t("#system-general-buttons").show(),t("#system-detail-buttons").hide(),t("#MessagesDetailSystem").hide(),t("#MessagesSystem").show())}function at(n){n?(t("#inbox-general-buttons").hide(),t("#inbox-detail-buttons").show(),t("#MessagesDetailInbox").show(),t("#MessagesInbox").hide()):(t("#inbox-general-buttons").show(),t("#inbox-detail-buttons").hide(),t("#MessagesDetailInbox").hide(),t("#MessagesInbox").show())}function pt(n){n?(t("#archive-general-buttons").hide(),t("#archive-detail-buttons").show(),t("#MessagesDetailArchive").show(),t("#MessagesArchived").hide()):(t("#MessagesDetailArchive").hide(),t("#archive-general-buttons").show(),t("#archive-detail-buttons").hide(),t("#MessagesArchived").show())}function l(n,t){switch(n){case r.Archive:pt(t);break;case r.Inbox:at(t);break;case r.Sent:yt(t);break;case r.Notifications:case r.Announcements:lt(t)}}function dt(n,t){var i=null;switch(n){case r.Notifications:i={Pager:Roblox.NotificationsPager,PageNumber:t.notificationsPage};break;case r.Archive:i={Pager:Roblox.ArchivedPager,PageNumber:t.archivePage};break;case r.Sent:i={Pager:Roblox.SentPager,PageNumber:t.sentPage};break;case r.Inbox:i={Pager:Roblox.MessagesPager,PageNumber:t.messagePage}}return i}function d(n){var f,a;if(c){c=!1;return}if(f=i,l(f,!1),f=n.tab,v?(a="#MessagesTabs a[href*='"+it+(f+1)+"']",t(a).click(),p=!0):y&&(v=!0),y||(v=!0),f!=r.Announcements){var s=dt(f,n),u=s.Pager,e=s.PageNumber,o=u.totalItems;u!==undefined&&(u.callUpdatePager(o,e),u.totalItems=o,e=u.getCurrentPage()),h(u,(e-1)*20+1,o)}}function h(n,r){r<0&&(r=0);var f="/getmessages",u={tab:i,startIndex:r?r-1:0,maxRows:s,cacheBuster:tt()};t.ajax({type:"POST",data:u,url:f,dataType:"html",success:function(t){g(n,t)},error:function(){n.itemContainerDiv.html(nt)}})}function w(n){switch(n){case r.Archive:return"#MessagesDetailArchive";case r.Sent:return"#MessagesDetailSent";case r.Notifications:return"#MessagesDetailSystem";default:return"#MessagesDetailInbox"}}function ft(n){switch(n){case r.Archive:return"#MessagesArchived";case r.Sent:return"#MessagesSent";case r.Notifications:return"#MessagesSystem";default:return"#MessagesInbox"}}function et(n,r){t("a.roblox-replyToMessage").removeClass("disabled");var f="/message/"+n,u=w(r);t(u).load(f,function(t,u){if(u!="error"){l(r,!0);var e=History.getState().data;c=!0,History.pushState({archivePage:e.archivePage||1,messagePage:e.messagePage||1,sentPage:e.sentPage||1,tab:i,messageId:n},"ROBLOX - "+Resources.Messages.messages,"?"+a(i))}});return}function ut(n){var f=w(n),u=ft(n),r,i;l(n,!1),t(f).hide(),t(u).show(),r=History.getState().data,i="div[data-messageid="+r.messageId+"].messageDivider",t(i).removeClass("unread"),t(i).addClass("read")}function st(n){switch(n){case r.Inbox:return b;case r.Archive:return k;case r.Notifications:return ot}return""}function f(n,u,f){var c="/messages/changeMessageStatus?",e=u.getStartIndex()-1,l;if(f)c+="messageIds="+f;else{var v=st(i),h=t(v+":checked"),y=i==t(v);if(h.length==0)return!1;if(i!=r.Notifications&&(n==0||n==1)&&y.length==h.length&&u.isLastPage()&&e!=0){e=e-s;var o=History.getState().data,w=i!=r.Inbox?o.archivePage:o.archivePage-1,p=i!=r.Inbox?o.messagePage:o.messagePage-1;History.replaceState({archivePage:w||1,messagePage:p||1,tab:i},"ROBLOX - "+Resources.Messages.messages,"?"+a(i))}h.each(function(){var n=t(this).data("messageid");c+="messageIds="+n+"&"})}l={actionType:n,tab:i,startIndex:e,maxRows:s,cacheBuster:tt()},t.ajax({type:"POST",data:l,url:c,dataType:"html",success:function(n){g(u,n)},error:function(){u.itemContainerDiv.html(nt)}})}function g(n,u){var o,e,s,f;if(l(i),n.updateHtml(u),o=t("#tab"+i+"resultsTotal").val(),n.callUpdatePager(o),n.totalItems=o,e=[[".roblox-archiveButton",".roblox-markAsReadInbox",".roblox-markAsUnreadInbox"],[],[".roblox-moveToInboxButton",".roblox-markAsReadArchive",".roblox-markAsUnreadArchive"]],s=i==r.Inbox?".roblox-archiveAll":".roblox-moveAllToInbox",t(s).prop("checked",!1),o==0){for(f=0;f<e[i].length;f++)t(e[i][f]).addClass("disabled");t(s).attr("disabled",!0),n.itemContainerDiv.html(ht)}else{for(f=0;f<e[i].length;f++)t(e[i][f]).removeClass("disabled");t(s).removeAttr("disabled")}Roblox.Widgets.AvatarImage.populate()}var r={Inbox:0,Sent:1,Notifications:4,Archive:3,Announcements:2},o=[{HashPart:"inbox",TabValue:r.Inbox},{HashPart:"sent",TabValue:r.Sent},{HashPart:"notifications",TabValue:r.Notifications},{HashPart:"archive",TabValue:r.Archive},{HashPart:"announcements",TabValue:r.Announcements}],e={MarkArchived:0,MarkUnarchived:1,MarkAsRead:2,MarkAsUnread:3,Delete:4},it="tabs-",p=!1,s,y,v=!0,nt="<span class='singleMessage'>"+Resources.Messages.sorry+"</span>",ht="<span class='singleMessage'>"+Resources.Messages.noMessages+"</span>",bt="ROBLOX - Messages",c=!1,i=0,rt=!1;t("#MessagesTabs").on("tabsactivate",function(n,t){if(p){var f=History.getState().data,u=t.newTab.data("name");u=="Sent"&&(i=r.Sent),u=="Notifications"&&(i=r.Notifications),u=="Inbox"&&(i=r.Inbox),u=="Archive"&&(i=r.Archive),u=="Announcements"&&(i=r.Announcements),rt=!0,v=!1,History.pushState({archivePage:f.archivePage||1,messagePage:f.messagePage||1,sentPage:f.sentPage||1,notificationsPage:f.notificationsPage||1,tab:i},"ROBLOX -"+Resources.Messages.messages,"?"+a(i))}});var b=".roblox-inboxCheckbox input[type=checkbox]",k=".roblox-archiveCheckbox input[type=checkbox]",ot=".roblox-systemCheckbox input[type=checkbox]";return t(".roblox-archiveAll").click(function(){t(b).prop("checked",this.checked)}),t(".roblox-moveAllToInbox").click(function(){t(k).prop("checked",this.checked)}),t(".roblox-markAsReadInbox").click(function(){f(e.MarkAsRead,Roblox.MessagesPager)}),t(".roblox-markAsUnreadInbox").click(function(){f(e.MarkAsUnread,Roblox.MessagesPager)}),t(".roblox-markAsReadSystem").click(function(){f(e.MarkAsRead,Roblox.NotificationsPager)}),t(".roblox-markAsUnreadSystem").click(function(){f(e.MarkAsUnread,Roblox.NotificationsPager)}),t(".roblox-deleteButtonSystem").click(function(){f(e.MarkArchived,Roblox.NotificationsPager)}),t(".roblox-markAsReadArchive").click(function(){f(e.MarkAsRead,Roblox.ArchivedPager)}),t(".roblox-markAsUnreadArchive").click(function(){f(e.MarkAsUnread,Roblox.ArchivedPager)}),t(".roblox-moveToInboxButton").click(function(){f(e.MarkUnarchived,Roblox.ArchivedPager)}),t(".roblox-archiveButton").click(function(){f(e.MarkArchived,Roblox.MessagesPager)}),t(".roblox-archiveMessage").click(function(){var n=History.getState().data;f(e.MarkArchived,Roblox.MessagesPager,n.messageId)}),t(".roblox-moveToInboxMessage").click(function(){var n=History.getState().data;f(e.MarkUnarchived,Roblox.ArchivedPager,n.messageId)}),t(".roblox-deleteMessage").click(function(){var i=History.getState().data,n=t(this).hasClass("roblox-archived")?Roblox.ArchivedPager:Roblox.MessagesPager;f(e.Delete,n,i.messageId)}),t(".roblox-replyToMessage").click(function(){t(this).hasClass("disabled")||(t(".message-reply").show(),t(".messages-reply-box").focus(),t(this).addClass("disabled"))}),t(".roblox-messageback").click(function(){var n=History.getState().data;return ut(n.tab),!1}),t(".roblox-sendMessage").click(function(){var n=t(this).data("messageid"),r=t(".messages-reply-box[data-messageid="+n+"]").val(),i={body:r,inReplyToMessageId:n};t.ajax({type:"POST",data:i,url:url,dataType:"html"})}),t(".roblox-notificationRow").click(function(){var n=t(this).data("messageid"),r=t(".roblox-notificationMessage-"+n),i=r.css("display")!="none";i?t(".roblox-notificationMessage-"+n).slideUp("fast"):t(".roblox-notificationMessage-"+n).slideDown("fast")}),{init:vt,loadState:d,loadMessage:et}});
